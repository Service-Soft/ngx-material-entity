<div class="mat-elevation-z8 elevation-container">
    <div class="array-headline">
        <b>{{metadata.displayName}}</b>
    </div>
    <div *ngIf="!isReadOnly">
        <mat-form-field appearance="standard">
            <mat-label>{{metadata.displayName}}</mat-label>
            
            <mat-date-range-input [rangePicker]="picker" [required]="metadata.required" [dateFilter]="metadata.filter ? metadata.filter : DateUtilities.defaultDateFilter">
                <input matStartDate
                    [(ngModel)]="dateRangeStart"
                    [name]="key.toString() + 'start'"
                    #startModel="ngModel"
                    [required]="metadata.required"
                    [min]="metadata.minStart ? metadata.minStart(input?.start) : undefined"
                    [max]="metadata.maxStart ? metadata.maxStart(input?.start) : undefined"
                    [placeholder]="metadata.placeholderStart"
                >
                <input matEndDate
                    [(ngModel)]="dateRangeEnd"
                    [name]="key.toString() + 'end'"
                    #endModel="ngModel"
                    [required]="metadata.required"
                    [min]="metadata.minEnd ? metadata.minEnd(input?.end) : undefined"
                    [max]="metadata.maxEnd ? metadata.maxEnd(input?.end) : undefined"
                    [placeholder]="metadata.placeholderEnd"
                >
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
    
            <mat-error *ngIf="startModel.errors">{{getValidationErrorMessage(startModel)}}</mat-error>
            <mat-error *ngIf="!startModel.errors && endModel.errors">{{getValidationErrorMessage(endModel)}}</mat-error>
        </mat-form-field>
        
        <div class="buttons">
            <button type="button" mat-raised-button
                [disabled]="startModel.errors || endModel.errors"
                (click)="addDateRange()">
                {{metadata.addButtonLabel}}
            </button>
            <button type="button" mat-raised-button
                [disabled]="!selection.selected.length"
                (click)="remove()">
                {{metadata.removeButtonLabel}}
            </button>
        </div>
    </div>

    <mat-table [dataSource]="dataSource">
        <!-- select Column -->
        <ng-container matColumnDef="select">
            <mat-header-cell *matHeaderCellDef>
                <mat-checkbox [disabled]="!dataSource.data.length" (change)="$event ? masterToggle() : null" [checked]="selection.hasValue() && isAllSelected()" [indeterminate]="selection.hasValue() && !isAllSelected()"></mat-checkbox>
            </mat-header-cell>
            <mat-cell *matCellDef="let module">
                <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(module) : null" [checked]="selection.isSelected(module)"></mat-checkbox>
            </mat-cell>
        </ng-container>
    
        <ng-container *ngFor="let dCol of metadata.displayColumns" [matColumnDef]="dCol.displayName">
            <mat-header-cell *matHeaderCellDef>
                {{dCol.displayName}}
            </mat-header-cell>
            <mat-cell class="entity" *matCellDef="let entity">
                {{dCol.value(entity)}}
            </mat-cell>
        </ng-container>
    
        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
    </mat-table>

    <div class="array-error" *ngIf="metadata.required && !dataSource.data.length">
        {{metadata.missingErrorMessage}}
    </div>
</div>